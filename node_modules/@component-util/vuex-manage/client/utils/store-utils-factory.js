import _ from 'lodash';

/**
 * 构建vuex所需的store-utils
 * @return {{getModules: (function(*): (store.modules|{}))}}
 */
const create = function () {
    const getModules = function (requireComponent) {
        const store = {modules: {}};
        requireComponent.keys().forEach(fileName => {
            let itemStoreData = requireComponent(fileName);
            itemStoreData = itemStoreData.default || itemStoreData;
            let dirs = _.without(
                _.compact(fileName.replace(/^\.*[\\/]/, '').replace(/\/\w+\.js$/i, '').split(/[\\/]/)),
                'store'
            );
            let currentContext = store;
            dirs.map(d => {
                let modules = currentContext.modules = currentContext.modules || {};
                currentContext = modules[d] = modules[d] || {};
            });
            _.extend(currentContext, {namespaced: true}, itemStoreData);
        });
        return store.modules;
    };

    return {getModules};
};

export default {create};
