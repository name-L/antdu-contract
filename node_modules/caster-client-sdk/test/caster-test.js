/*!
 * Copyright (c) 2010-2015 EEFUNG Software Co.Ltd. All rights reserved.
 * 版权所有 (c) 2010-2015 湖南蚁坊软件有限公司。保留所有权利。
 */

"use strict";

/**
 *
 * Created by wuyaoqian on 16/3/29.
 */

// 只初始化一次全局日志配置信息（主要是将原来的json变成js -- 方便写注释）
require("log4js-config").init(function () {
    return require("./config/app-logging.js");
});

var CasterClient = require('../index');
var mapManage = CasterClient.mapManage;

var promise = mapManage.getInstance('test-map', 1000 * 60 * 0.5);
//var promise = storeManage.getInstance('civiw-ic-session', 1000 * 60 * 5);
//var promise = storeManage.getInstance('www-civiw-ic-session', 1000 * 60 * 5);

// setTimeout(function () {
//
//     var listenerObject = {
//         added: function (key, oldValue, value, mergingValue) {
//             console.log('(instance1) add:', key, oldValue, value, mergingValue);
//         },
//         updated: function (key, oldValue, value, mergingValue) {
//             console.log('(instance1) update:', key, oldValue, value, mergingValue);
//         },
//         removed: function (key, oldValue, value, mergingValue) {
//             console.log('(instance1) remove:', key, oldValue, value, mergingValue);
//         },
//         evicted: function (key, oldValue, value, mergingValue) {
//             console.log('(instance1) evicted:', key, oldValue, value, mergingValue);
//         }
//     };
//     instance.map.addEntryListener(listenerObject, undefined, true);
//
// }, 1000 * 5);

promise.then(function (instance) {
    var count = 1;
    setInterval(function () {
        var key = '(instance1) key-' + (count++);

        // var val = '1⚐中💦2😭‍🙆😔5';
        // var val = {'a':'✎﹏ J中OJO糾ั͡✾✎ ͡',b:3714832748, c:{a:'✎﹏ 1⚐中💦2😭‍🙆😔5J中OJ'}};
        // var val = '﹏ JOJO糾ั͡✾✎';
        // var val = '✎﹏ 1⚐中💦2😭‍🙆😔5J中OJO糾ั͡✾✎ ͡';
        var val = '༊྄ཻᏴ࿆Ꮻ࿆Ꭶ࿆Ꮥ࿆ 💰࿐';

        instance.put(key, val, function (error) {
            if (error) {
                console.warn('put data error: ', key, error)
            } else {

                // if (count % 5 === 0) {
                //     instance.del(key);
                // }

                console.info('put data success: ', key);
                instance.get(key, function (error, data) {
                    if (error) {
                        //console.warn('get data error: ', key, error)
                    } else {
                        console.info('get data success: ', key, data);
                    }
                });
            }
        });

    }, 2000);
});

