/*!
 * Copyright (c) 2010-2016 EEFUNG Software Co.Ltd. All rights reserved.
 * 版权所有 (c) 2010-2016 湖南蚁坊软件有限公司。保留所有权利。
 */

"use strict";

/*
 * 扩展 log4js, log4js-config
 * 让其支持 js 文件的配置
 */

var log4js = require("log4js-config");
var fs = require("fs");
var path = require("path");

/**
 * Private function that returns the default name of the config file
 */
var defaultConfigFileName = [
    "logging.js", "logging.json", "app-logging.js", "app-logging.json", "logging-config.js", "logging-config.json"
];

/**
 * Private function that returns an array that contains all folders where the logging config
 * file could be located
 */
var defaultSearchPath = ["./", "./config"];

/**
 * This is the default function that locates the configuration file, which should be in the root
 * of the application folder structure, be called app-loggin.js and follow log4js' configuration
 * file structure.
 *
 * @return {Object}
 */
var log4jsConfig = (function defaultConfigFileLocator() {

    // allow the environment to override our logic, as per standard log4js
    if (process.env.LOG4JS_CONFIG) {
        return require(path.join(process.cwd(), process.env.LOG4JS_CONFIG));
    }

    var foundConfigFile;
    defaultSearchPath.some(function (path) {
        defaultConfigFileName.some(function (name) {
            if (fs.existsSync(path + "/" + name)) {
                foundConfigFile = path + "/" + name;
                return true;
            }
        });
        if (foundConfigFile) {
            return true;
        }
    });

    if (foundConfigFile) {
        return require(path.join(process.cwd(), foundConfigFile));
    }
})();

if (log4jsConfig) {
    log4js.init(function () {
        return log4jsConfig;
    });
}

module.exports = log4js;
