/*!
 * Copyright (c) 2010-2015 EEFUNG Software Co.Ltd. All rights reserved.
 * ç‰ˆæƒæ‰€æœ‰ (c) 2010-2015 æ¹–å—èšåŠè½¯ä»¶æœ‰é™å…¬å¸ã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚
 */

"use strict";

/**
 *
 * Created by wuyaoqian on 16/3/29.
 */

// åªåˆå§‹åŒ–ä¸€æ¬¡å…¨å±€æ—¥å¿—é…ç½®ä¿¡æ¯ï¼ˆä¸»è¦æ˜¯å°†åŸæ¥çš„jsonå˜æˆjs -- æ–¹ä¾¿å†™æ³¨é‡Šï¼‰
require("log4js-config").init(function () {
    return require("./config/app-logging.js");
});

var CasterClient = require('../index');

CasterClient.topicManage.getInstance('test-topic').then(function (instance) {

    var publish = function (val) {
        var startTime = new Date().getTime();
        instance.publish(val).then(function () {
            var elapsed = new Date().getTime() - startTime;
            console.log('publish success, time: %ss, val: ', elapsed / 1000, val);
        });
    };

    // topic.addMessageListener(function (e) {
    //     console.log('receive message: ', e);
    // });

    publish('âšä¸­ğŸ’¦2ğŸ˜­â€ğŸ™†ğŸ˜”5');

    var count = 1;
    setInterval(function () {
        var key = '(instance1) key-' + (count++);
        publish(key + 'âšä¸­ğŸ’¦2ğŸ˜­â€ğŸ™†ğŸ˜”5');
    }, 2000);

});