/*!
 * Copyright (c) 2010-2015 EEFUNG Software Co.Ltd. All rights reserved.
 * ç‰ˆæƒæ‰€æœ‰ (c) 2010-2015 æ¹–å—èšåŠè½¯ä»¶æœ‰é™å…¬å¸ã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚
 */

"use strict";

/**
 *
 * Created by wuyaoqian on 16/3/29.
 */

// åªåˆå§‹åŒ–ä¸€æ¬¡å…¨å±€æ—¥å¿—é…ç½®ä¿¡æ¯ï¼ˆä¸»è¦æ˜¯å°†åŸæ¥çš„jsonå˜æˆjs -- æ–¹ä¾¿å†™æ³¨é‡Šï¼‰
require("log4js-config").init(function () {
    return require("./config/app-logging.js");
});

var CasterClient = require('../index');
var mapManage = CasterClient.mapManage;

var promise = mapManage.getInstance('test-map', 1000 * 60 * 0.5);
//var promise = storeManage.getInstance('civiw-ic-session', 1000 * 60 * 5);
//var promise = storeManage.getInstance('www-civiw-ic-session', 1000 * 60 * 5);

// setTimeout(function () {
//
//     var listenerObject = {
//         added: function (key, oldValue, value, mergingValue) {
//             console.log('(instance1) add:', key, oldValue, value, mergingValue);
//         },
//         updated: function (key, oldValue, value, mergingValue) {
//             console.log('(instance1) update:', key, oldValue, value, mergingValue);
//         },
//         removed: function (key, oldValue, value, mergingValue) {
//             console.log('(instance1) remove:', key, oldValue, value, mergingValue);
//         },
//         evicted: function (key, oldValue, value, mergingValue) {
//             console.log('(instance1) evicted:', key, oldValue, value, mergingValue);
//         }
//     };
//     instance.map.addEntryListener(listenerObject, undefined, true);
//
// }, 1000 * 5);

promise.then(function (instance) {
    var count = 1;
    setInterval(function () {
        var key = '(instance1) key-' + (count++);

        // var val = '1âšä¸­ğŸ’¦2ğŸ˜­â€ğŸ™†ğŸ˜”5';
        // var val = {'a':'âœï¹ Jä¸­OJOç³¾à¸±Í¡âœ¾âœ Í¡',b:3714832748, c:{a:'âœï¹ 1âšä¸­ğŸ’¦2ğŸ˜­â€ğŸ™†ğŸ˜”5Jä¸­OJ'}};
        // var val = 'ï¹ JOJOç³¾à¸±Í¡âœ¾âœî€ƒ';
        // var val = 'âœï¹ 1âšä¸­ğŸ’¦2ğŸ˜­â€ğŸ™†ğŸ˜”5Jä¸­OJOç³¾à¸±Í¡âœ¾âœ Í¡';
        var val = 'à¼Šà¾„à½»á´à¿†á«à¿†á¦à¿†á•à¿† ğŸ’°à¿';

        instance.put(key, val, function (error) {
            if (error) {
                console.warn('put data error: ', key, error)
            } else {

                // if (count % 5 === 0) {
                //     instance.del(key);
                // }

                console.info('put data success: ', key);
                instance.get(key, function (error, data) {
                    if (error) {
                        //console.warn('get data error: ', key, error)
                    } else {
                        console.info('get data success: ', key, data);
                    }
                });
            }
        });

    }, 2000);
});

