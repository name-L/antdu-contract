/*!
 * Copyright (c) 2010-2016 EEFUNG Software Co.Ltd. All rights reserved.
 * 版权所有 (c) 2010-2016 湖南蚁坊软件有限公司。保留所有权利。
 */

"use strict";

const io = require("socket.io-client");

/**
 *
 * Created by wuyaoqian on 2017/1/17.
 */

const tryConnect = (nsp) => {
    console.log('try connect nsp: ', nsp);
    let serverSocket, client = io.managers['http://172.19.104.120:9093'];
    if (!client || !(serverSocket = client.nsps[nsp])) {
        serverSocket = io("http://172.19.104.120:9093" + nsp, {
            transports: ['websocket'],
            timeout: 1000 * 15,
            reconnection: false,
            autoConnect: false
        });
        serverSocket.io.opts.query = "access_token=163Ymw4im4Oubtx0p7tInR3I";
    }
    serverSocket.connect();
};

setTimeout(function () {
    tryConnect('/topic-monitor');
}, 0);
setTimeout(function () {
    tryConnect('/socket-distribute');
}, 1000 * 2);
setTimeout(function () {
    tryConnect('/topic-monitor');
}, 1000 * 4);

const http = require("http");
http.createServer(function (request, response) {
    response.writeHead(200, {"Content-Type": "text/plain"});
    response.write("Hello World");
    response.end();
}).listen(process.env.port || 8801);