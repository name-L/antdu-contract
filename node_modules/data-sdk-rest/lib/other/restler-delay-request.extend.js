/*!
 * Copyright (c) 2010-2020 EEFUNG Software Co.Ltd. All rights reserved.
 * 版权所有 (c) 2010-2020 湖南蚁坊软件股份有限公司。保留所有权利。
 */

'use strict';

/**
 * 请求延时执行的扩展
 * Created by wuyaoqian on 2017/3/3.
 */

const interceptRequestRun = function (Request) {
    // 1. 扩展 run 方法
    const oldRun = Request.prototype.run;
    Request.prototype.run = function () {
        if (!this.options['delay-request']) {
            return oldRun.call(this);
        }
        return this;
    };

    // 2. 增加延迟执行方法
    Request.prototype.initDelayRequestHandle = function () {
        const instance = this;
        instance.options['delay-request'] = true;
        return function () {
            process.nextTick(function () {
                delete instance.options['delay-request'];
                oldRun.call(instance);
            });
        };
    };
};

module.exports = {
    extendInit: interceptRequestRun
};
